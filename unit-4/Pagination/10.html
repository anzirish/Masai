<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style></style>
  </head>
  <body>
    <div
      id="container"
      style="display: flex; flex-direction: column; gap: 10px"
    ></div>
    <div
      id="page-button-container"
      style="
        display: flex;
        gap: 30px;
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: red;
      "
    ></div>
    <script>
      const BASE_API_URL = "https://jsonplaceholder.typicode.com/users";
      let currentPage = 1;
      let totalPages = 1;
      let limit = 6;
      const buttonContainer = document.getElementById("page-button-container");
      const container = document.getElementById("container");
      
      // create button and load initial users when dom loaded
      document.addEventListener("DOMContentLoaded", () => {
        getUsersCount();
        fetchUsers();
      });

      // Calculate total user length
      async function getUsersCount() {
        buttonContainer.innerHTML = "";
        try {
          const respone = await fetch(BASE_API_URL);
          if (respone.ok) {
            const users = await respone.json();
            createButtons(users.length);
          }
        } catch (error) {
          console.log(error);
        }
      }

      // Fetch users from api 
      async function fetchUsers() {
        container.innerHTML = "";
        try {
            const respone = await fetch(
              `${BASE_API_URL}?_page=${currentPage}&_limit=${limit}`
            );
            console.log(`${BASE_API_URL}?_page=${currentPage}&limit=${limit}`)
            if (respone.ok) {
              const users = await respone.json();
              display(users);
            }
        } catch (error) {
            console.log(error);
        }
      }

      // Create page buttons based on total users  length and limit
      function createButtons(length) {
        totalPages = Math.ceil(length / limit);

        for (let i = 0; i < totalPages; i++) {
          const button = document.createElement("button");
          button.textContent = i + 1;
          buttonContainer.appendChild(button);
          button.addEventListener("click", () => {
            const page = parseInt(button.textContent);
            if (page != currentPage) {
              currentPage = page;
              fetchUsers();
            }
          });
        }
      }

      // Display users
      function display(users) {
        container.innerHTML = "";
        users.forEach((user) => {
          const div = document.createElement("div");
          const username = document.createElement("p");
          const email = document.createElement("p");
          const moreInfo = document.createElement("button");
          // Show info on alert if user clicks on more info button
          moreInfo.addEventListener("click", () => {
            alert(`Name: ${user.name}\nUsername: ${user.username}\nEmail: ${user.email}\nPhone: ${user.phone}\nWebsite: ${user.website}`);
          });

          username.textContent = user.username;
          email.textContent = user.email;
          moreInfo.textContent = 'More info'
          div.style.border = "2px solid aqua";
          div.append(username, email, moreInfo);
          container.appendChild(div);
        });
      }
    </script>
  </body>
</html>
